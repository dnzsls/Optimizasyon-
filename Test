â€œâ€â€
19 Vardiya ile Kapasite Planlama - AYLIK
Date kolonu ile Ã§alÄ±ÅŸÄ±r
â€œâ€â€
import pandas as pd
import math

# ============= TEMEL FONKSÄ°YONLAR =============

def erlang_c(agents, traffic):
if agents <= traffic or agents == 0:
return 1.0
erlang_b = traffic / agents
for i in range(2, int(agents) + 1):
erlang_b = (traffic * erlang_b) / (i + traffic * erlang_b)
erlang_c_val = erlang_b / (1 - (traffic / agents) * (1 - erlang_b))
return min(erlang_c_val, 1.0)

def calculate_asa(agents, traffic, aht):
if agents <= traffic:
return 999
ec = erlang_c(agents, traffic)
asa = (ec * (aht / 60)) / (agents - traffic) * 60
return asa

def find_agents_for_target(calls, interval_min, aht, target_asa):
if calls == 0:
return 0
traffic = (calls * (aht / 60)) / interval_min
if traffic == 0:
return 0
min_agents = math.ceil(traffic)
max_agents = math.ceil(traffic * 2) + 5
for agents in range(min_agents, max_agents + 1):
asa = calculate_asa(agents, traffic, aht)
if asa <= target_asa:
return agents
return max_agents

def time_to_minutes(time_str):
â€œâ€â€â€˜07:30â€™ â†’ 450 dakikaâ€â€â€
h, m = map(int, time_str.split(â€™:â€™))
return h * 60 + m

def is_time_in_shift(time_str, shift_start, shift_end):
â€œâ€â€œBir zaman vardiya iÃ§inde mi kontrol et (gece vardiyasÄ± dahil)â€â€â€
time_min = time_to_minutes(time_str)
start_min = time_to_minutes(shift_start)
end_min = time_to_minutes(shift_end)

```
if end_min <= start_min:  # Gece vardiyasÄ±
    return time_min >= start_min or time_min < end_min
else:  # Normal vardiya
    return start_min <= time_min < end_min
```

# ============= 19 VARDÄ°YA TANIMI =============

SHIFTS_A21 = [
{â€˜nameâ€™: â€˜V1â€™, â€˜startâ€™: â€˜07:00â€™, â€˜endâ€™: â€˜16:00â€™, â€˜durationâ€™: 9.0},
{â€˜nameâ€™: â€˜V2â€™, â€˜startâ€™: â€˜08:00â€™, â€˜endâ€™: â€˜17:00â€™, â€˜durationâ€™: 9.0},
{â€˜nameâ€™: â€˜V3â€™, â€˜startâ€™: â€˜09:00â€™, â€˜endâ€™: â€˜18:00â€™, â€˜durationâ€™: 9.0},
{â€˜nameâ€™: â€˜V4â€™, â€˜startâ€™: â€˜10:00â€™, â€˜endâ€™: â€˜19:00â€™, â€˜durationâ€™: 9.0},
{â€˜nameâ€™: â€˜V5â€™, â€˜startâ€™: â€˜15:00â€™, â€˜endâ€™: â€˜24:00â€™, â€˜durationâ€™: 9.0},
{â€˜nameâ€™: â€˜V6â€™, â€˜startâ€™: â€˜17:00â€™, â€˜endâ€™: â€˜01:00â€™, â€˜durationâ€™: 8.0},
{â€˜nameâ€™: â€˜V7â€™, â€˜startâ€™: â€˜18:00â€™, â€˜endâ€™: â€˜02:00â€™, â€˜durationâ€™: 8.0},
{â€˜nameâ€™: â€˜V8â€™, â€˜startâ€™: â€˜19:00â€™, â€˜endâ€™: â€˜03:00â€™, â€˜durationâ€™: 8.0},
{â€˜nameâ€™: â€˜V9â€™, â€˜startâ€™: â€˜00:00â€™, â€˜endâ€™: â€˜08:00â€™, â€˜durationâ€™: 8.0},
]

SHIFTS_B21 = [
{â€˜nameâ€™: â€˜V10â€™, â€˜startâ€™: â€˜08:00â€™, â€˜endâ€™: â€˜17:30â€™, â€˜durationâ€™: 9.5},
{â€˜nameâ€™: â€˜V11â€™, â€˜startâ€™: â€˜09:00â€™, â€˜endâ€™: â€˜18:30â€™, â€˜durationâ€™: 9.5},
{â€˜nameâ€™: â€˜V12â€™, â€˜startâ€™: â€˜10:00â€™, â€˜endâ€™: â€˜19:30â€™, â€˜durationâ€™: 9.5},
{â€˜nameâ€™: â€˜V13â€™, â€˜startâ€™: â€˜11:00â€™, â€˜endâ€™: â€˜20:30â€™, â€˜durationâ€™: 9.5},
{â€˜nameâ€™: â€˜V14â€™, â€˜startâ€™: â€˜12:00â€™, â€˜endâ€™: â€˜21:30â€™, â€˜durationâ€™: 9.5},
{â€˜nameâ€™: â€˜V15â€™, â€˜startâ€™: â€˜13:00â€™, â€˜endâ€™: â€˜22:30â€™, â€˜durationâ€™: 9.5},
{â€˜nameâ€™: â€˜V16â€™, â€˜startâ€™: â€˜14:00â€™, â€˜endâ€™: â€˜23:30â€™, â€˜durationâ€™: 9.5},
{â€˜nameâ€™: â€˜V17â€™, â€˜startâ€™: â€˜15:00â€™, â€˜endâ€™: â€˜00:30â€™, â€˜durationâ€™: 9.5},
{â€˜nameâ€™: â€˜V18â€™, â€˜startâ€™: â€˜17:00â€™, â€˜endâ€™: â€˜01:30â€™, â€˜durationâ€™: 8.5},
{â€˜nameâ€™: â€˜V19â€™, â€˜startâ€™: â€˜18:00â€™, â€˜endâ€™: â€˜02:30â€™, â€˜durationâ€™: 8.5},
]

ALL_SHIFTS = SHIFTS_A21 + SHIFTS_B21

# ============= INTERVAL BAZLI Ä°HTÄ°YAÃ‡ =============

def calculate_interval_requirements(df, interval_min=30, aht=180,
target_asa=30, shrinkage=0.10):
â€œâ€â€
Her interval iÃ§in agent ihtiyacÄ± (BAÄIMSIZ)

```
DataFrame formatÄ±:
- date: '2025-01-01'
- time: '07:00'
- queue_a: Ã§aÄŸrÄ± sayÄ±sÄ±
- queue_b: Ã§aÄŸrÄ± sayÄ±sÄ±
"""
results = []

for idx, row in df.iterrows():
    date = row['date']
    time = row['time']
    calls_a = row['queue_a']
    calls_b = row['queue_b']
    
    # A iÃ§in
    agents_a_raw = find_agents_for_target(calls_a, interval_min, aht, target_asa)
    agents_a_final = math.ceil(agents_a_raw / (1 - shrinkage))
    
    # B iÃ§in
    agents_b_raw = find_agents_for_target(calls_b, interval_min, aht, target_asa)
    agents_b_final = math.ceil(agents_b_raw / (1 - shrinkage))
    
    results.append({
        'date': date,
        'time': time,
        'calls_a': calls_a,
        'calls_b': calls_b,
        'agents_a': agents_a_final,
        'agents_b': agents_b_final,
        'total_agents': agents_a_final + agents_b_final
    })

return pd.DataFrame(results)
```

# ============= VARDÄ°YA BAZLI Ä°HTÄ°YAÃ‡ (GÃœNLÃœK) =============

def calculate_shift_requirements_monthly(interval_df, shifts):
â€œâ€â€
AylÄ±k vardiya bazlÄ± agent ihtiyacÄ±

```
Her GÃœN iÃ§in her vardiyaya kaÃ§ agent gerek?
"""
shift_results = []

# Her tarih iÃ§in ayrÄ± hesapla
for date in interval_df['date'].unique():
    date_intervals = interval_df[interval_df['date'] == date]
    
    # Her vardiya iÃ§in
    for shift in shifts:
        shift_intervals = date_intervals[
            date_intervals['time'].apply(
                lambda t: is_time_in_shift(t, shift['start'], shift['end'])
            )
        ]
        
        if len(shift_intervals) == 0:
            agents_a = 0
            agents_b = 0
            max_total = 0
        else:
            agents_a = shift_intervals['agents_a'].max()
            agents_b = shift_intervals['agents_b'].max()
            max_total = shift_intervals['total_agents'].max()
        
        shift_results.append({
            'date': date,
            'shift': shift['name'],
            'start': shift['start'],
            'end': shift['end'],
            'duration': shift['duration'],
            'agents_a': int(agents_a),
            'agents_b': int(agents_b),
            'total': int(max_total)
        })

return pd.DataFrame(shift_results)
```

# ============= ANA FONKSÄ°YON =============

def calculate_monthly(df):
â€œâ€â€
AylÄ±k hesaplama

```
GiriÅŸ DataFrame:
- date: '2025-01-01', '2025-01-01', ...
- time: '00:00', '00:30', ...
- queue_a: Ã§aÄŸrÄ± sayÄ±sÄ±
- queue_b: Ã§aÄŸrÄ± sayÄ±sÄ±
"""

print("=" * 70)
print("AYLIK KAPASÄ°TE PLANLAMA - 19 VARDÄ°YA")
print("=" * 70)

# Veri kontrolÃ¼
unique_dates = df['date'].nunique()
total_intervals = len(df)

print(f"\nğŸ“‹ Veri Ã–zeti:")
print(f"   Tarih aralÄ±ÄŸÄ±: {df['date'].min()} - {df['date'].max()}")
print(f"   GÃ¼n sayÄ±sÄ±: {unique_dates}")
print(f"   Toplam interval: {total_intervals}")
print(f"   Interval/GÃ¼n: {total_intervals / unique_dates:.0f}")

# ADIM 1: Interval bazlÄ±
print("\nâš™ï¸ ADIM 1: Interval bazlÄ± hesaplama...")
interval_req = calculate_interval_requirements(df)

print(f"âœ… {len(interval_req)} interval hesaplandÄ±")

# ADIM 2: Vardiya bazlÄ± (gÃ¼nlÃ¼k)
print("\nâš™ï¸ ADIM 2: GÃ¼nlÃ¼k vardiya bazlÄ± hesaplama...")
shift_req = calculate_shift_requirements_monthly(interval_req, ALL_SHIFTS)

# SÄ±fÄ±r agentli vardiyalarÄ± filtrele
shift_req_active = shift_req[shift_req['total'] > 0]

print(f"âœ… {len(shift_req_active)} aktif vardiya-gÃ¼n kombinasyonu")
print(f"   (Toplam {len(shift_req)} olasÄ±lÄ±ktan)")

return interval_req, shift_req, shift_req_active
```

# ============= TEST =============

if **name** == â€˜**main**â€™:

```
# Ã–rnek: 7 gÃ¼nlÃ¼k veri (1 hafta)
dates = pd.date_range('2025-01-01', '2025-01-07', freq='D')
times = pd.date_range('00:00', '23:30', freq='30min').strftime('%H:%M')

# Her gÃ¼n iÃ§in 48 interval
sample_rows = []
for date in dates:
    for i, time in enumerate(times):
        # Hafta iÃ§i / hafta sonu farkÄ±
        is_weekend = date.dayofweek >= 5  # 5=Cumartesi, 6=Pazar
        
        if is_weekend:
            # Hafta sonu: %60 Ã§aÄŸrÄ±
            factor = 0.6
        else:
            # Hafta iÃ§i: normal
            factor = 1.0
        
        # GÃ¼n iÃ§i pattern (basit)
        if 6 <= i < 24:  # 06:00-12:00 (Sabah)
            calls_a = int(30 * factor)
            calls_b = int(15 * factor)
        elif 24 <= i < 36:  # 12:00-18:00 (Ã–ÄŸle-AkÅŸam)
            calls_a = int(50 * factor)
            calls_b = int(25 * factor)
        elif 36 <= i < 44:  # 18:00-22:00 (AkÅŸam)
            calls_a = int(35 * factor)
            calls_b = int(18 * factor)
        else:  # Gece
            calls_a = int(10 * factor)
            calls_b = int(5 * factor)
        
        sample_rows.append({
            'date': date.strftime('%Y-%m-%d'),
            'time': time,
            'queue_a': calls_a,
            'queue_b': calls_b
        })

sample_data = pd.DataFrame(sample_rows)

# Hesapla
interval_req, shift_req_all, shift_req_active = calculate_monthly(sample_data)

# SonuÃ§larÄ± gÃ¶ster
print("\n" + "=" * 70)
print("ğŸ“Š Ã–RNEK SONUÃ‡LAR (Ä°lk 20 satÄ±r)")
print("=" * 70)
print(shift_req_active.head(20).to_string(index=False))

# GÃ¼nlÃ¼k Ã¶zet
print("\n" + "=" * 70)
print("ğŸ“Š GÃœNLÃœK Ã–ZET")
print("=" * 70)

daily_summary = shift_req_active.groupby('date').agg({
    'total': 'sum',
    'agents_a': 'sum',
    'agents_b': 'sum',
    'shift': 'count'
}).rename(columns={'shift': 'active_shifts'})

print(daily_summary)

print("\n" + "=" * 70)
print("âœ… AYLIK HESAPLAMA TAMAMLANDI")
print("=" * 70)
print("\nKullanÄ±m:")
print("  df = pd.read_excel('cagri_tahminleri.xlsx')")
print("  # Kolonlar: date, time, queue_a, queue_b")
print("  interval_req, shift_req, shift_active = calculate_monthly(df)")
print("  shift_active.to_excel('vardiya_plani.xlsx', index=False)")
```
