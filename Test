WITH scored AS (
  SELECT
    client_no,
    buy_prob,
    true_flag_1,
    -- En yüksek skordan aşağıya kümülatif yüzde
    CUME_DIST() OVER (ORDER BY buy_prob DESC) AS cume_top
  FROM your_table
),
binned AS (
  SELECT
    client_no,
    buy_prob,
    true_flag_1,
    /* 1..20: 1 = en üst %5, 20 = en alt %5 */
    CEIL(cume_top * 20) AS bin20
  FROM scored
)
SELECT
  bin20,
  -- bin20=1 ~ 95–100, bin20=2 ~ 90–95, ... (tepeden aşağı)
  ROUND(MIN(buy_prob), 4) AS min_th,
  ROUND(MAX(buy_prob), 4) AS max_th,
  COUNT(*)                AS n,
  SUM(true_flag_1)        AS tp,
  ROUND(SUM(true_flag_1)/COUNT(*), 3) AS precision_rate
FROM binned
GROUP BY bin20
ORDER BY bin20;
