"""
FONKSÄ°YON 5: Shrinkage Ekleme
GerÃ§ek dÃ¼nya: Agentlar %100 verimli Ã§alÄ±ÅŸamaz
"""
import math

def erlang_c(agents, traffic):
    if agents <= traffic or agents == 0:
        return 1.0
    erlang_b = traffic / agents
    for i in range(2, int(agents) + 1):
        erlang_b = (traffic * erlang_b) / (i + traffic * erlang_b)
    erlang_c_val = erlang_b / (1 - (traffic / agents) * (1 - erlang_b))
    return min(erlang_c_val, 1.0)

def calculate_asa(agents, traffic, aht):
    if agents <= traffic:
        return 999
    ec = erlang_c(agents, traffic)
    asa = (ec * (aht / 60)) / (agents - traffic) * 60
    return asa

def find_agents_for_target(calls, interval_min, aht, target_asa):
    if calls == 0:
        return 0
    traffic = (calls * (aht / 60)) / interval_min
    if traffic == 0:
        return 0
    
    min_agents = math.ceil(traffic)
    max_agents = math.ceil(traffic * 2) + 5  # âœ… GÃ¼ncellendi!
    
    for agents in range(min_agents, max_agents + 1):
        asa = calculate_asa(agents, traffic, aht)
        if asa <= target_asa:
            return agents
    return max_agents


def apply_shrinkage(raw_agents, shrinkage_pct):
    """
    Shrinkage uygula
    
    Ne demek?
    - Agentlar mola, tuvalet, eÄŸitim, izin yapÄ±yor
    - %10 shrinkage = Agentlar zamanÄ±n %10'unda Ã§alÄ±ÅŸmÄ±yor
    - O yÃ¼zden daha fazla agent Ã§alÄ±ÅŸtÄ±rmalÄ±yÄ±z
    
    FormÃ¼l:
    Final Agent = Ham Agent / (1 - Shrinkage)
    
    Ã–rnek:
    - 10 agent gerekiyor
    - %10 shrinkage
    - Final = 10 / 0.9 = 11.1 â†’ 12 agent
    """
    final_agents = raw_agents / (1 - shrinkage_pct)
    return math.ceil(final_agents)  # YukarÄ± yuvarla


# TEST EDELÄ°M
if __name__ == '__main__':
    print("=" * 60)
    print("FONKSÄ°YON 5: SHRINKAGE")
    print("=" * 60)
    
    print("\nğŸ’¡ Shrinkage Nedir?")
    print("  Agentlar sÃ¼rekli Ã§alÄ±ÅŸamaz:")
    print("  - Mola: 15 dakika")
    print("  - Tuvalet: 5 dakika")
    print("  - ToplantÄ±/EÄŸitim: 30 dakika")
    print("  - Sistem problemi: 10 dakika")
    print("  â†’ Toplam ~60 dakika = %10 shrinkage (8 saatte)\n")
    
    # Parametreler
    calls = 50
    interval = 30
    aht = 180
    target = 30
    shrinkage = 0.10  # %10
    
    # 1. Ham agent hesapla
    raw_agents = find_agents_for_target(calls, interval, aht, target)
    
    # 2. Shrinkage uygula
    final_agents = apply_shrinkage(raw_agents, shrinkage)
    
    # KarÅŸÄ±laÅŸtÄ±rma
    traffic = (calls * (aht/60)) / interval
    
    print(f"Senaryo: {calls} Ã§aÄŸrÄ±, {interval} dakika interval")
    print(f"Traffic: {traffic:.1f} Erlang\n")
    
    print(f"1ï¸âƒ£ Ham Hesaplama (Shrinkage yok):")
    print(f"   Gereken agent: {raw_agents}")
    print(f"   ASA: {calculate_asa(raw_agents, traffic, aht):.1f} sn\n")
    
    print(f"2ï¸âƒ£ Shrinkage ile ({shrinkage*100:.0f}%):")
    print(f"   Final agent: {final_agents}")
    print(f"   Fark: +{final_agents - raw_agents} agent")
    print(f"   Neden? Agentlar zamanÄ±n %{shrinkage*100:.0f}'u Ã§alÄ±ÅŸmÄ±yor\n")
    
    # FarklÄ± shrinkage oranlarÄ±
    print("=" * 60)
    print("ğŸ“Š FARKLI SHRINKAGE ORANLARI")
    print("=" * 60)
    print(f"\nHam agent ihtiyacÄ±: {raw_agents}\n")
    
    for shrink in [0.05, 0.10, 0.15, 0.20]:
        final = apply_shrinkage(raw_agents, shrink)
        diff = final - raw_agents
        print(f"Shrinkage %{shrink*100:.0f}: {final} agent (+{diff})")
    
    print("\n" + "=" * 60)
    print("ğŸ’¡ Ã–ÄRENME:")
    print("  - Ham hesaplama = Teorik minimum")
    print("  - Shrinkage = GerÃ§ek dÃ¼nya payÄ±")
    print("  - Her zaman shrinkage ekle!")
    print("=" * 60)
    print("\nâ¡ï¸ Sonraki: Tek bir interval iÃ§in tam hesaplama")
