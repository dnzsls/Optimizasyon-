import pandas as pd
import numpy as np
import math

# KonfigÃ¼rasyon

CONFIG = {
â€˜ahtâ€™: 188,  # saniye
â€˜target_slâ€™: 0.80,  # %80 servis seviyesi
â€˜target_asaâ€™: 30,  # 30 saniye iÃ§inde yanÄ±t
â€˜shrinkageâ€™: 0.10,  # %10 mola/eÄŸitim/izin
â€˜interval_minutesâ€™: 30,
â€˜b_queue_ratio_weekdayâ€™: 0.40  # B kuyruÄŸu hafta iÃ§i %40 oranÄ±
}

# Vardiya tanÄ±mlarÄ±

SHIFTS = [
{â€˜nameâ€™: â€˜V1â€™, â€˜startâ€™: â€˜07:00â€™, â€˜endâ€™: â€˜16:00â€™, â€˜durationâ€™: 9},
{â€˜nameâ€™: â€˜V2â€™, â€˜startâ€™: â€˜08:00â€™, â€˜endâ€™: â€˜17:00â€™, â€˜durationâ€™: 9},
{â€˜nameâ€™: â€˜V3â€™, â€˜startâ€™: â€˜09:00â€™, â€˜endâ€™: â€˜18:00â€™, â€˜durationâ€™: 9},
{â€˜nameâ€™: â€˜V4â€™, â€˜startâ€™: â€˜10:00â€™, â€˜endâ€™: â€˜19:00â€™, â€˜durationâ€™: 9},
{â€˜nameâ€™: â€˜V5â€™, â€˜startâ€™: â€˜15:00â€™, â€˜endâ€™: â€˜24:00â€™, â€˜durationâ€™: 9},
{â€˜nameâ€™: â€˜V6â€™, â€˜startâ€™: â€˜17:00â€™, â€˜endâ€™: â€˜01:00â€™, â€˜durationâ€™: 8, â€˜overnightâ€™: True},
{â€˜nameâ€™: â€˜V7â€™, â€˜startâ€™: â€˜18:00â€™, â€˜endâ€™: â€˜02:00â€™, â€˜durationâ€™: 8, â€˜overnightâ€™: True},
{â€˜nameâ€™: â€˜V8â€™, â€˜startâ€™: â€˜19:00â€™, â€˜endâ€™: â€˜03:00â€™, â€˜durationâ€™: 8, â€˜overnightâ€™: True},
{â€˜nameâ€™: â€˜V9â€™, â€˜startâ€™: â€˜00:00â€™, â€˜endâ€™: â€˜08:00â€™, â€˜durationâ€™: 8},
{â€˜nameâ€™: â€˜V10â€™, â€˜startâ€™: â€˜08:00â€™, â€˜endâ€™: â€˜17:30â€™, â€˜durationâ€™: 9.5},
{â€˜nameâ€™: â€˜V11â€™, â€˜startâ€™: â€˜09:00â€™, â€˜endâ€™: â€˜18:30â€™, â€˜durationâ€™: 9.5},
{â€˜nameâ€™: â€˜V12â€™, â€˜startâ€™: â€˜10:00â€™, â€˜endâ€™: â€˜19:30â€™, â€˜durationâ€™: 9.5},
{â€˜nameâ€™: â€˜V13â€™, â€˜startâ€™: â€˜11:00â€™, â€˜endâ€™: â€˜20:30â€™, â€˜durationâ€™: 9.5},
{â€˜nameâ€™: â€˜V14â€™, â€˜startâ€™: â€˜12:00â€™, â€˜endâ€™: â€˜21:30â€™, â€˜durationâ€™: 9.5},
{â€˜nameâ€™: â€˜V15â€™, â€˜startâ€™: â€˜13:00â€™, â€˜endâ€™: â€˜22:30â€™, â€˜durationâ€™: 9.5},
{â€˜nameâ€™: â€˜V16â€™, â€˜startâ€™: â€˜14:00â€™, â€˜endâ€™: â€˜23:30â€™, â€˜durationâ€™: 9.5},
{â€˜nameâ€™: â€˜V17â€™, â€˜startâ€™: â€˜15:00â€™, â€˜endâ€™: â€˜00:30â€™, â€˜durationâ€™: 9.5, â€˜overnightâ€™: True},
{â€˜nameâ€™: â€˜V18â€™, â€˜startâ€™: â€˜17:00â€™, â€˜endâ€™: â€˜01:30â€™, â€˜durationâ€™: 8.5, â€˜overnightâ€™: True},
{â€˜nameâ€™: â€˜V19â€™, â€˜startâ€™: â€˜18:00â€™, â€˜endâ€™: â€˜02:30â€™, â€˜durationâ€™: 8.5, â€˜overnightâ€™: True}
]

def erlang_c(agents, traffic):
â€œâ€â€œErlang C formÃ¼lÃ¼ ile kuyruk olasÄ±lÄ±ÄŸÄ± hesaplaâ€â€â€
if agents <= traffic or agents == 0:
return 1.0

```
# Erlang B hesapla
erlang_b = traffic / agents
for i in range(2, int(agents) + 1):
    erlang_b = (traffic * erlang_b) / (i + traffic * erlang_b)

# Erlang C hesapla
erlang_c_val = erlang_b / (1 - (traffic / agents) * (1 - erlang_b))
return min(erlang_c_val, 1.0)
```

def calculate_agents(calls, interval_min, aht, target_asa):
â€œâ€â€œGerekli agent sayÄ±sÄ±nÄ± hesaplaâ€â€â€
if calls == 0:
return 0

```
# Traffic hesapla (Erlang)
traffic = (calls * (aht / 60)) / interval_min

if traffic == 0:
    return 0

# Binary search ile optimal agent sayÄ±sÄ±nÄ± bul
min_agents = math.ceil(traffic)
max_agents = math.ceil(traffic * 3) + 5

for agents in range(min_agents, max_agents + 1):
    ec = erlang_c(agents, traffic)
    
    # Average Speed to Answer (ASA) hesapla
    if agents > traffic:
        asa = (ec * (aht / 60)) / (agents - traffic) * 60  # saniye
    else:
        asa = 999
    
    if asa <= target_asa:
        return agents

return max_agents
```

def generate_sample_data(is_weekend=False):
â€œâ€â€œÃ–rnek Ã§aÄŸrÄ± verisi oluÅŸtur - 24 saat, 30 dakikalÄ±k intervallerleâ€â€â€
multiplier = 0.6 if is_weekend else 1.0

```
data = []
for hour in range(24):
    for minute in [0, 30]:
        time = f"{hour:02d}:{minute:02d}"
        
        # GÃ¼n iÃ§indeki yoÄŸunluÄŸa gÃ¶re Ã§aÄŸrÄ± sayÄ±sÄ±
        if 8 <= hour <= 16:  # Peak saatler
            base_a = 80 + (hour - 8) * 5
            base_b = 30 + (hour - 8) * 2
        elif 17 <= hour <= 22:  # AkÅŸam
            base_a = 70 - (hour - 17) * 10
            base_b = 25 - (hour - 17) * 4
        else:  # Gece
            base_a = 5
            base_b = 2
        
        data.append({
            'time': time,
            'queue_a': round(base_a * multiplier),
            'queue_b': round(base_b * multiplier)
        })

return pd.DataFrame(data)
```

def calculate_weekday_staffing(df):
â€œâ€â€
Hafta iÃ§i agent ihtiyacÄ±nÄ± hesapla
Kuyruk mantÄ±ÄŸÄ±: B agentlarÄ± B Ã§aÄŸrÄ±larÄ±nÄ±n %40â€™Ä±nÄ± karÅŸÄ±lar, %60â€™Ä± Aâ€™ya yardÄ±m eder
â€œâ€â€
results = []

```
for idx, row in df.iterrows():
    # B kuyruÄŸu: Sadece B Ã§aÄŸrÄ±larÄ±nÄ±n %40'Ä±nÄ± karÅŸÄ±lar
    b_only_calls = row['queue_b'] * CONFIG['b_queue_ratio_weekday']
    agents_b_only = calculate_agents(
        b_only_calls,
        CONFIG['interval_minutes'],
        CONFIG['aht'],
        CONFIG['target_asa']
    )
    
    # A kuyruÄŸu + B'nin kalan %60'Ä± (B agentlarÄ± A'ya yardÄ±m eder)
    b_helps_a_calls = row['queue_b'] * (1 - CONFIG['b_queue_ratio_weekday'])
    total_a_calls = row['queue_a'] + b_helps_a_calls
    agents_a = calculate_agents(
        total_a_calls,
        CONFIG['interval_minutes'],
        CONFIG['aht'],
        CONFIG['target_asa']
    )
    
    # Shrinkage ekle (mola, eÄŸitim, izin iÃ§in %10 ekstra)
    final_agents_a = math.ceil(agents_a / (1 - CONFIG['shrinkage']))
    final_agents_b = math.ceil(agents_b_only / (1 - CONFIG['shrinkage']))
    
    results.append({
        'time': row['time'],
        'queue_a_calls': row['queue_a'],
        'queue_b_calls': row['queue_b'],
        'agents_a': final_agents_a,
        'agents_b': final_agents_b,
        'total_agents': final_agents_a + final_agents_b
    })

return pd.DataFrame(results)
```

def calculate_weekend_staffing(df):
â€œâ€â€
Hafta sonu agent ihtiyacÄ±nÄ± hesapla
Kuyruk mantÄ±ÄŸÄ±: Kuyruklar arasÄ± yardÄ±m YOK, her kuyruk baÄŸÄ±msÄ±z
â€œâ€â€
results = []

```
for idx, row in df.iterrows():
    # A kuyruÄŸu
    agents_a = calculate_agents(
        row['queue_a'],
        CONFIG['interval_minutes'],
        CONFIG['aht'],
        CONFIG['target_asa']
    )
    
    # B kuyruÄŸu
    agents_b = calculate_agents(
        row['queue_b'],
        CONFIG['interval_minutes'],
        CONFIG['aht'],
        CONFIG['target_asa']
    )
    
    # Shrinkage ekle
    final_agents_a = math.ceil(agents_a / (1 - CONFIG['shrinkage']))
    final_agents_b = math.ceil(agents_b / (1 - CONFIG['shrinkage']))
    
    results.append({
        'time': row['time'],
        'queue_a_calls': row['queue_a'],
        'queue_b_calls': row['queue_b'],
        'agents_a': final_agents_a,
        'agents_b': final_agents_b,
        'total_agents': final_agents_a + final_agents_b
    })

return pd.DataFrame(results)
```

def is_time_in_shift(time_str, shift):
â€œâ€â€œZaman diliminin vardiya iÃ§inde olup olmadÄ±ÄŸÄ±nÄ± kontrol etâ€â€â€
h, m = map(int, time_str.split(â€™:â€™))
time_minutes = h * 60 + m

```
start_h, start_m = map(int, shift['start'].split(':'))
start_minutes = start_h * 60 + start_m

end_h, end_m = map(int, shift['end'].split(':'))
end_minutes = end_h * 60 + end_m

# Gece vardiyalarÄ± iÃ§in (ertesi gÃ¼ne geÃ§en)
if shift.get('overnight', False) and end_minutes <= start_minutes:
    end_minutes += 24 * 60
    if time_minutes < start_minutes:
        time_minutes += 24 * 60

return start_minutes <= time_minutes < end_minutes
```

def calculate_shift_requirements(weekday_df, weekend_df):
â€œâ€â€œVardiya bazlÄ± agent ihtiyacÄ±nÄ± hesaplaâ€â€â€
shift_results = []

```
for shift in SHIFTS:
    # Hafta iÃ§i iÃ§in bu vardiyada max ihtiyaÃ§
    weekday_intervals = weekday_df[
        weekday_df['time'].apply(lambda x: is_time_in_shift(x, shift))
    ]
    weekday_max = weekday_intervals['total_agents'].max() if len(weekday_intervals) > 0 else 0
    
    # Hafta sonu iÃ§in bu vardiyada max ihtiyaÃ§
    weekend_intervals = weekend_df[
        weekend_df['time'].apply(lambda x: is_time_in_shift(x, shift))
    ]
    weekend_max = weekend_intervals['total_agents'].max() if len(weekend_intervals) > 0 else 0
    
    shift_results.append({
        'shift_name': shift['name'],
        'start_time': shift['start'],
        'end_time': shift['end'],
        'duration_hours': shift['duration'],
        'weekday_agents_needed': int(weekday_max),
        'weekend_agents_needed': int(weekend_max)
    })

return pd.DataFrame(shift_results)
```

def main():
â€œâ€â€œAna fonksiyon - tÃ¼m hesaplamalarÄ± yap ve sonuÃ§larÄ± gÃ¶sterâ€â€â€

```
print("=" * 80)
print("Ã‡AÄRI MERKEZÄ° KAPASÄ°TE PLANLAMA ANALÄ°ZÄ°")
print("=" * 80)
print(f"\nKonfigÃ¼rasyon:")
print(f"  - AHT: {CONFIG['aht']} saniye")
print(f"  - Hedef Servis Seviyesi: {CONFIG['target_sl']*100}%")
print(f"  - Hedef YanÄ±t SÃ¼resi: {CONFIG['target_asa']} saniye")
print(f"  - Shrinkage: {CONFIG['shrinkage']*100}%")
print(f"  - B Kuyruk OranÄ± (Hafta Ä°Ã§i): {CONFIG['b_queue_ratio_weekday']*100}%")
print("\n" + "=" * 80)

# 1. Ã–rnek veri oluÅŸtur
print("\n[1/4] Ã–rnek Ã§aÄŸrÄ± verisi oluÅŸturuluyor...")
weekday_calls = generate_sample_data(is_weekend=False)
weekend_calls = generate_sample_data(is_weekend=True)

# 2. Hafta iÃ§i agent hesapla
print("[2/4] Hafta iÃ§i agent ihtiyacÄ± hesaplanÄ±yor...")
weekday_staffing = calculate_weekday_staffing(weekday_calls)

# 3. Hafta sonu agent hesapla
print("[3/4] Hafta sonu agent ihtiyacÄ± hesaplanÄ±yor...")
weekend_staffing = calculate_weekend_staffing(weekend_calls)

# 4. Vardiya analizi
print("[4/4] Vardiya bazlÄ± analiz yapÄ±lÄ±yor...")
shift_analysis = calculate_shift_requirements(weekday_staffing, weekend_staffing)

# Ã–zet istatistikler
print("\n" + "=" * 80)
print("ğŸ“Š HAFTA Ä°Ã‡Ä° Ã–ZET")
print("-" * 80)
print(f"Toplam GÃ¼nlÃ¼k Ã‡aÄŸrÄ±: {weekday_staffing['queue_a_calls'].sum() + weekday_staffing['queue_b_calls'].sum()}")
print(f"Peak Agent Ä°htiyacÄ±: {weekday_staffing['total_agents'].max()}")
print(f"Ortalama Agent Ä°htiyacÄ±: {weekday_staffing['total_agents'].mean():.1f}")
print(f"Peak Saati: {weekday_staffing.loc[weekday_staffing['total_agents'].idxmax(), 'time']}")

print("\nğŸ“Š HAFTA SONU Ã–ZET")
print("-" * 80)
print(f"Toplam GÃ¼nlÃ¼k Ã‡aÄŸrÄ±: {weekend_staffing['queue_a_calls'].sum() + weekend_staffing['queue_b_calls'].sum()}")
print(f"Peak Agent Ä°htiyacÄ±: {weekend_staffing['total_agents'].max()}")
print(f"Ortalama Agent Ä°htiyacÄ±: {weekend_staffing['total_agents'].mean():.1f}")
print(f"Peak Saati: {weekend_staffing.loc[weekend_staffing['total_agents'].idxmax(), 'time']}")

print("\n" + "=" * 80)
print("\nğŸ“‹ HAFTA Ä°Ã‡Ä° DETAYLI AGENT Ä°HTÄ°YACI (Ä°lk 20 satÄ±r)")
print("-" * 80)
print(weekday_staffing.head(20).to_string(index=False))

print("\n\nğŸ“‹ HAFTA SONU DETAYLI AGENT Ä°HTÄ°YACI (Ä°lk 20 satÄ±r)")
print("-" * 80)
print(weekend_staffing.head(20).to_string(index=False))

print("\n\nğŸ“… VARDÄ°YA BAZLI AGENT Ä°HTÄ°YACI")
print("-" * 80)
print(shift_analysis.to_string(index=False))

print("\n" + "=" * 80)

# Excel'e kaydet
try:
    with pd.ExcelWriter('call_center_staffing_plan.xlsx', engine='openpyxl') as writer:
        weekday_staffing.to_excel(writer, sheet_name='Hafta_Ici', index=False)
        weekend_staffing.to_excel(writer, sheet_name='Hafta_Sonu', index=False)
        shift_analysis.to_excel(writer, sheet_name='Vardiya_Plani', index=False)
    print("\nâœ… SonuÃ§lar 'call_center_staffing_plan.xlsx' dosyasÄ±na kaydedildi!")
except Exception as e:
    print(f"\nâš ï¸  Excel kaydetme hatasÄ±: {e}")
    print("Not: openpyxl kurulu deÄŸilse: pip install openpyxl")

# DataFrame'leri dÃ¶ndÃ¼r
return weekday_staffing, weekend_staffing, shift_analysis
```

# Ã‡ALIÅTIR

if **name** == â€œ**main**â€:
weekday_df, weekend_df, shifts_df = main()

```
# Ek analiz Ã¶rneÄŸi - Peak saatlere odaklan
print("\n\nğŸ” PEAK SAATLER ANALÄ°ZÄ° (09:00-17:00)")
print("-" * 80)
peak_hours = weekday_df[
    (weekday_df['time'] >= '09:00') & 
    (weekday_df['time'] <= '17:00')
]
print(peak_hours.to_string(index=False))
```
