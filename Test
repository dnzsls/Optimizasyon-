import pandas as pd
import numpy as np
from typing import Optional, List

# ---------------------------
# 1) Fonksiyon
# ---------------------------
def optimize_threshold_reason1_only(
    df: pd.DataFrame,
    *,
    min_count: int = 500,
    grid_step: float = 0.01,
    reasons: Optional[List[str]] = None,
    unique_customers: bool = True
) -> pd.DataFrame:
    """
    call_prob'u tamamen dışarıda bırakır; sadece reason1 üzerinden threshold seçer.
    Beklenen kolonlar: customer_id, reason1_pred, reason1_prob, true_reason
    """
    required = ["customer_id", "reason1_pred", "reason1_prob", "true_reason"]
    miss = [c for c in required if c not in df.columns]
    if miss:
        raise ValueError(f"Eksik kolon(lar): {miss}")

    data = df.copy()

    # (Öneri) metin normalizasyonu
    for c in ["reason1_pred", "true_reason"]:
        data[c] = data[c].astype(str).str.strip()

    # Çalışılacak reason listesi
    if reasons is None:
        reasons = sorted(data["true_reason"]_]()
