â€œâ€â€
Vardiya KesiÅŸim BazlÄ± Agent DaÄŸÄ±tÄ±mÄ±
Az kesiÅŸen vardiyaya daha az, Ã§ok kesiÅŸene daha az agent
â€œâ€â€
import pandas as pd
import math

# ============= VARDÄ°YA TANIMLARI =============

SHIFTS_A21 = [
{â€˜nameâ€™: â€˜V1â€™, â€˜startâ€™: â€˜07:00â€™, â€˜endâ€™: â€˜16:00â€™, â€˜durationâ€™: 9.0},
{â€˜nameâ€™: â€˜V2â€™, â€˜startâ€™: â€˜08:00â€™, â€˜endâ€™: â€˜17:00â€™, â€˜durationâ€™: 9.0},
{â€˜nameâ€™: â€˜V3â€™, â€˜startâ€™: â€˜09:00â€™, â€˜endâ€™: â€˜18:00â€™, â€˜durationâ€™: 9.0},
{â€˜nameâ€™: â€˜V4â€™, â€˜startâ€™: â€˜10:00â€™, â€˜endâ€™: â€˜19:00â€™, â€˜durationâ€™: 9.0},
{â€˜nameâ€™: â€˜V5â€™, â€˜startâ€™: â€˜15:00â€™, â€˜endâ€™: â€˜24:00â€™, â€˜durationâ€™: 9.0},
{â€˜nameâ€™: â€˜V6â€™, â€˜startâ€™: â€˜17:00â€™, â€˜endâ€™: â€˜01:00â€™, â€˜durationâ€™: 8.0},
{â€˜nameâ€™: â€˜V7â€™, â€˜startâ€™: â€˜18:00â€™, â€˜endâ€™: â€˜02:00â€™, â€˜durationâ€™: 8.0},
{â€˜nameâ€™: â€˜V8â€™, â€˜startâ€™: â€˜19:00â€™, â€˜endâ€™: â€˜03:00â€™, â€˜durationâ€™: 8.0},
{â€˜nameâ€™: â€˜V9â€™, â€˜startâ€™: â€˜00:00â€™, â€˜endâ€™: â€˜08:00â€™, â€˜durationâ€™: 8.0},
]

SHIFTS_B21 = [
{â€˜nameâ€™: â€˜V10â€™, â€˜startâ€™: â€˜08:00â€™, â€˜endâ€™: â€˜17:30â€™, â€˜durationâ€™: 9.5},
{â€˜nameâ€™: â€˜V11â€™, â€˜startâ€™: â€˜09:00â€™, â€˜endâ€™: â€˜18:30â€™, â€˜durationâ€™: 9.5},
{â€˜nameâ€™: â€˜V12â€™, â€˜startâ€™: â€˜10:00â€™, â€˜endâ€™: â€˜19:30â€™, â€˜durationâ€™: 9.5},
{â€˜nameâ€™: â€˜V13â€™, â€˜startâ€™: â€˜11:00â€™, â€˜endâ€™: â€˜20:30â€™, â€˜durationâ€™: 9.5},
{â€˜nameâ€™: â€˜V14â€™, â€˜startâ€™: â€˜12:00â€™, â€˜endâ€™: â€˜21:30â€™, â€˜durationâ€™: 9.5},
{â€˜nameâ€™: â€˜V15â€™, â€˜startâ€™: â€˜13:00â€™, â€˜endâ€™: â€˜22:30â€™, â€˜durationâ€™: 9.5},
{â€˜nameâ€™: â€˜V16â€™, â€˜startâ€™: â€˜14:00â€™, â€˜endâ€™: â€˜23:30â€™, â€˜durationâ€™: 9.5},
{â€˜nameâ€™: â€˜V17â€™, â€˜startâ€™: â€˜15:00â€™, â€˜endâ€™: â€˜00:30â€™, â€˜durationâ€™: 9.5},
{â€˜nameâ€™: â€˜V18â€™, â€˜startâ€™: â€˜17:00â€™, â€˜endâ€™: â€˜01:30â€™, â€˜durationâ€™: 8.5},
{â€˜nameâ€™: â€˜V19â€™, â€˜startâ€™: â€˜18:00â€™, â€˜endâ€™: â€˜02:30â€™, â€˜durationâ€™: 8.5},
]

ALL_SHIFTS = SHIFTS_A21 + SHIFTS_B21

# ============= YARDIMCI FONKSÄ°YONLAR =============

def time_to_minutes(time_str):
â€œâ€â€â€˜07:30â€™ â†’ 450 dakikaâ€â€â€
h, m = map(int, time_str.split(â€™:â€™))
return h * 60 + m

def shifts_overlap(shift1, shift2):
â€œâ€â€œÄ°ki vardiya kesiÅŸiyor mu?â€â€â€
s1_start = time_to_minutes(shift1[â€˜startâ€™])
s1_end = time_to_minutes(shift1[â€˜endâ€™])
s2_start = time_to_minutes(shift2[â€˜startâ€™])
s2_end = time_to_minutes(shift2[â€˜endâ€™])

```
# Gece vardiyasÄ± kontrolÃ¼
if s1_end <= s1_start:
    s1_end += 24 * 60
if s2_end <= s2_start:
    s2_end += 24 * 60

# Normalize et (0-1440 aralÄ±ÄŸÄ±na)
# KesiÅŸim kontrolÃ¼
return not (s1_end <= s2_start or s2_end <= s1_start or 
            (s1_end - 24*60) <= s2_start or s2_end <= (s1_start + 24*60))
```

def calculate_overlap_count(shift, all_shifts):
â€œâ€â€œBir vardiya kaÃ§ vardiya ile kesiÅŸiyor?â€â€â€
count = 0
for other_shift in all_shifts:
if shift[â€˜nameâ€™] != other_shift[â€˜nameâ€™]:
if shifts_overlap(shift, other_shift):
count += 1
return count

def is_time_in_shift(time_str, shift_start, shift_end):
â€œâ€â€œBir zaman vardiya iÃ§inde mi?â€â€â€
time_min = time_to_minutes(time_str)
start_min = time_to_minutes(shift_start)
end_min = time_to_minutes(shift_end)

```
if end_min <= start_min:  # Gece vardiyasÄ±
    return time_min >= start_min or time_min < end_min
else:
    return start_min <= time_min < end_min
```

# ============= KESÄ°ÅÄ°M BAZLI DAÄITIM =============

def distribute_agents_by_overlap(interval_df, shifts):
â€œâ€â€
KesiÅŸim sayÄ±sÄ±na gÃ¶re agent daÄŸÄ±tÄ±mÄ±

```
MantÄ±k:
1. Her vardiya iÃ§in kesiÅŸim sayÄ±sÄ±nÄ± hesapla
2. Her interval iÃ§in o anda Ã§alÄ±ÅŸan vardiyalarÄ± bul
3. Ä°htiyacÄ± kesiÅŸim oranÄ±na gÃ¶re daÄŸÄ±t (az kesiÅŸen â†’ daha Ã§ok agent)
"""

# ADIM 1: Her vardiya iÃ§in kesiÅŸim sayÄ±sÄ±nÄ± hesapla
print("\nâš™ï¸ ADIM 1: Vardiya kesiÅŸim sayÄ±larÄ± hesaplanÄ±yor...")

shift_overlaps = {}
for shift in shifts:
    overlap_count = calculate_overlap_count(shift, shifts)
    shift_overlaps[shift['name']] = {
        'shift': shift,
        'overlap_count': overlap_count
    }
    print(f"   {shift['name']}: {overlap_count} vardiya ile kesiÅŸiyor")

# ADIM 2: Her interval iÃ§in daÄŸÄ±tÄ±m yap
print("\nâš™ï¸ ADIM 2: Interval bazlÄ± daÄŸÄ±tÄ±m yapÄ±lÄ±yor...")

results = []

for date in sorted(interval_df['date'].unique()):
    date_intervals = interval_df[interval_df['date'] == date]
    
    # Her interval iÃ§in
    for idx, row in date_intervals.iterrows():
        time = row['time']
        total_needed = row['total_agents']
        
        if total_needed == 0:
            continue
        
        # Bu saatte Ã§alÄ±ÅŸan vardiyalarÄ± bul
        working_shifts = []
        for shift_name, info in shift_overlaps.items():
            shift = info['shift']
            if is_time_in_shift(time, shift['start'], shift['end']):
                working_shifts.append({
                    'name': shift_name,
                    'overlap_count': info['overlap_count']
                })
        
        if len(working_shifts) == 0:
            continue
        
        # KesiÅŸim oranÄ±na gÃ¶re daÄŸÄ±t
        # Az kesiÅŸen â†’ Daha fazla agent
        # Ters oran kullan: 1 / overlap_count
        total_weight = sum(1 / (ws['overlap_count'] + 1) for ws in working_shifts)
        
        for ws in working_shifts:
            weight = 1 / (ws['overlap_count'] + 1)
            ratio = weight / total_weight
            agents_needed = total_needed * ratio
            
            results.append({
                'date': date,
                'time': time,
                'shift': ws['name'],
                'agents_needed': agents_needed,
                'overlap_count': ws['overlap_count']
            })

return pd.DataFrame(results)
```

def aggregate_shift_requirements(distribution_df, shifts):
â€œâ€â€
Her vardiya iÃ§in toplam agent ihtiyacÄ±nÄ± hesapla
Her gÃ¼n iÃ§in her vardiyada MAX agent sayÄ±sÄ±
â€œâ€â€

```
shift_results = []

for date in sorted(distribution_df['date'].unique()):
    date_data = distribution_df[distribution_df['date'] == date]
    
    for shift in shifts:
        shift_data = date_data[date_data['shift'] == shift['name']]
        
        if len(shift_data) > 0:
            max_agents = math.ceil(shift_data['agents_needed'].max())
        else:
            max_agents = 0
        
        shift_results.append({
            'date': date,
            'shift': shift['name'],
            'start': shift['start'],
            'end': shift['end'],
            'duration': shift['duration'],
            'agents': max_agents
        })

return pd.DataFrame(shift_results)
```

# ============= TEST =============

if **name** == â€˜**main**â€™:

```
# Test verisi: Basit bir gÃ¼n
test_intervals = pd.DataFrame({
    'date': '2025-01-15',
    'time': ['07:00', '08:00', '09:00', '10:00', '15:00', '18:00', '00:00'],
    'total_agents': [50, 80, 135, 120, 90, 60, 20]
})

print("=" * 70)
print("VARDÄ°YA KESÄ°ÅÄ°M BAZLI DAÄITIM")
print("=" * 70)

# DaÄŸÄ±tÄ±m yap
distribution = distribute_agents_by_overlap(test_intervals, ALL_SHIFTS)

print("\n" + "=" * 70)
print("ğŸ“Š DAÄITIM SONUÃ‡LARI (09:00 Ã¶rneÄŸi)")
print("=" * 70)

sample = distribution[(distribution['time'] == '09:00')]
print(sample[['shift', 'agents_needed', 'overlap_count']].to_string(index=False))
print(f"\nToplam: {sample['agents_needed'].sum():.1f} (Hedef: 135)")

# Vardiya bazlÄ± toplam
shift_req = aggregate_shift_requirements(distribution, ALL_SHIFTS)
shift_req_active = shift_req[shift_req['agents'] > 0]

print("\n" + "=" * 70)
print("ğŸ“Š VARDÄ°YA BAZLI SONUÃ‡LAR")
print("=" * 70)
print(shift_req_active[['shift', 'start', 'end', 'agents']].to_string(index=False))

print("\nâœ… KesiÅŸim bazlÄ± daÄŸÄ±tÄ±m tamamlandÄ±!")
```
