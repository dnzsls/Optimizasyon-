â€œâ€â€
19 Vardiya ile Kapasite Planlama - Date kolonu + 15dk interval
â€œâ€â€
import pandas as pd
import math

# ============= TEMEL FONKSÄ°YONLAR =============

def erlang_c(agents, traffic):
if agents <= traffic or agents == 0:
return 1.0
erlang_b = traffic / agents
for i in range(2, int(agents) + 1):
erlang_b = (traffic * erlang_b) / (i + traffic * erlang_b)
erlang_c_val = erlang_b / (1 - (traffic / agents) * (1 - erlang_b))
return min(erlang_c_val, 1.0)

def calculate_asa(agents, traffic, aht):
if agents <= traffic:
return 999
ec = erlang_c(agents, traffic)
asa = (ec * (aht / 60)) / (agents - traffic) * 60
return asa

def find_agents_for_target(calls, interval_min, aht, target_asa):
if calls == 0:
return 0
traffic = (calls * (aht / 60)) / interval_min
if traffic == 0:
return 0
min_agents = math.ceil(traffic)
max_agents = math.ceil(traffic * 2) + 5
for agents in range(min_agents, max_agents + 1):
asa = calculate_asa(agents, traffic, aht)
if asa <= target_asa:
return agents
return max_agents

def time_to_minutes(time_str):
â€œâ€â€â€˜07:30â€™ â†’ 450 dakikaâ€â€â€
h, m = map(int, time_str.split(â€™:â€™))
return h * 60 + m

def is_time_in_shift(time_str, shift_start, shift_end):
â€œâ€â€œBir zaman vardiya iÃ§inde mi kontrol et (gece vardiyasÄ± dahil)â€â€â€
time_min = time_to_minutes(time_str)
start_min = time_to_minutes(shift_start)
end_min = time_to_minutes(shift_end)

```
if end_min <= start_min:  # Gece vardiyasÄ±
    return time_min >= start_min or time_min < end_min
else:  # Normal vardiya
    return start_min <= time_min < end_min
```

# ============= 19 VARDÄ°YA TANIMI =============

SHIFTS_A21 = [
{â€˜nameâ€™: â€˜V1â€™, â€˜startâ€™: â€˜07:00â€™, â€˜endâ€™: â€˜16:00â€™, â€˜durationâ€™: 9.0},
{â€˜nameâ€™: â€˜V2â€™, â€˜startâ€™: â€˜08:00â€™, â€˜endâ€™: â€˜17:00â€™, â€˜durationâ€™: 9.0},
{â€˜nameâ€™: â€˜V3â€™, â€˜startâ€™: â€˜09:00â€™, â€˜endâ€™: â€˜18:00â€™, â€˜durationâ€™: 9.0},
{â€˜nameâ€™: â€˜V4â€™, â€˜startâ€™: â€˜10:00â€™, â€˜endâ€™: â€˜19:00â€™, â€˜durationâ€™: 9.0},
{â€˜nameâ€™: â€˜V5â€™, â€˜startâ€™: â€˜15:00â€™, â€˜endâ€™: â€˜24:00â€™, â€˜durationâ€™: 9.0},
{â€˜nameâ€™: â€˜V6â€™, â€˜startâ€™: â€˜17:00â€™, â€˜endâ€™: â€˜01:00â€™, â€˜durationâ€™: 8.0},
{â€˜nameâ€™: â€˜V7â€™, â€˜startâ€™: â€˜18:00â€™, â€˜endâ€™: â€˜02:00â€™, â€˜durationâ€™: 8.0},
{â€˜nameâ€™: â€˜V8â€™, â€˜startâ€™: â€˜19:00â€™, â€˜endâ€™: â€˜03:00â€™, â€˜durationâ€™: 8.0},
{â€˜nameâ€™: â€˜V9â€™, â€˜startâ€™: â€˜00:00â€™, â€˜endâ€™: â€˜08:00â€™, â€˜durationâ€™: 8.0},
]

SHIFTS_B21 = [
{â€˜nameâ€™: â€˜V10â€™, â€˜startâ€™: â€˜08:00â€™, â€˜endâ€™: â€˜17:30â€™, â€˜durationâ€™: 9.5},
{â€˜nameâ€™: â€˜V11â€™, â€˜startâ€™: â€˜09:00â€™, â€˜endâ€™: â€˜18:30â€™, â€˜durationâ€™: 9.5},
{â€˜nameâ€™: â€˜V12â€™, â€˜startâ€™: â€˜10:00â€™, â€˜endâ€™: â€˜19:30â€™, â€˜durationâ€™: 9.5},
{â€˜nameâ€™: â€˜V13â€™, â€˜startâ€™: â€˜11:00â€™, â€˜endâ€™: â€˜20:30â€™, â€˜durationâ€™: 9.5},
{â€˜nameâ€™: â€˜V14â€™, â€˜startâ€™: â€˜12:00â€™, â€˜endâ€™: â€˜21:30â€™, â€˜durationâ€™: 9.5},
{â€˜nameâ€™: â€˜V15â€™, â€˜startâ€™: â€˜13:00â€™, â€˜endâ€™: â€˜22:30â€™, â€˜durationâ€™: 9.5},
{â€˜nameâ€™: â€˜V16â€™, â€˜startâ€™: â€˜14:00â€™, â€˜endâ€™: â€˜23:30â€™, â€˜durationâ€™: 9.5},
{â€˜nameâ€™: â€˜V17â€™, â€˜startâ€™: â€˜15:00â€™, â€˜endâ€™: â€˜00:30â€™, â€˜durationâ€™: 9.5},
{â€˜nameâ€™: â€˜V18â€™, â€˜startâ€™: â€˜17:00â€™, â€˜endâ€™: â€˜01:30â€™, â€˜durationâ€™: 8.5},
{â€˜nameâ€™: â€˜V19â€™, â€˜startâ€™: â€˜18:00â€™, â€˜endâ€™: â€˜02:30â€™, â€˜durationâ€™: 8.5},
]

ALL_SHIFTS = SHIFTS_A21 + SHIFTS_B21

# ============= INTERVAL BAZLI Ä°HTÄ°YAÃ‡ =============

def calculate_interval_requirements(df, interval_min=15, aht=180,
target_asa=30, shrinkage=0.10):
â€œâ€â€
Her interval iÃ§in agent ihtiyacÄ± (BAÄIMSIZ)

```
DataFrame formatÄ±:
- date: '2025-01-01'
- time: '07:00'
- queue_a: Ã§aÄŸrÄ± sayÄ±sÄ±
- queue_b: Ã§aÄŸrÄ± sayÄ±sÄ±
"""
results = []

for idx, row in df.iterrows():
    date = row['date']
    time = row['time']
    calls_a = row['queue_a']
    calls_b = row['queue_b']
    
    # A iÃ§in
    agents_a_raw = find_agents_for_target(calls_a, interval_min, aht, target_asa)
    agents_a_final = math.ceil(agents_a_raw / (1 - shrinkage))
    
    # B iÃ§in
    agents_b_raw = find_agents_for_target(calls_b, interval_min, aht, target_asa)
    agents_b_final = math.ceil(agents_b_raw / (1 - shrinkage))
    
    results.append({
        'date': date,
        'time': time,
        'calls_a': calls_a,
        'calls_b': calls_b,
        'agents_a': agents_a_final,
        'agents_b': agents_b_final,
        'total_agents': agents_a_final + agents_b_final
    })

return pd.DataFrame(results)
```

# ============= VARDÄ°YA BAZLI Ä°HTÄ°YAÃ‡ (GÃœNLÃœK) =============

def calculate_shift_requirements(interval_df, shifts):
â€œâ€â€
Vardiya bazlÄ± agent ihtiyacÄ± - GÃœNLÃœK
Her tarih iÃ§in ayrÄ± hesapla
â€œâ€â€
shift_results = []

```
# Her tarih iÃ§in
for date in interval_df['date'].unique():
    date_intervals = interval_df[interval_df['date'] == date]
    
    # Her vardiya iÃ§in
    for shift in shifts:
        shift_intervals = date_intervals[
            date_intervals['time'].apply(
                lambda t: is_time_in_shift(t, shift['start'], shift['end'])
            )
        ]
        
        if len(shift_intervals) == 0:
            agents_a = 0
            agents_b = 0
            max_total = 0
        else:
            agents_a = shift_intervals['agents_a'].max()
            agents_b = shift_intervals['agents_b'].max()
            max_total = shift_intervals['total_agents'].max()
        
        shift_results.append({
            'date': date,  # â† DATE EKLENDÄ°
            'shift': shift['name'],
            'start': shift['start'],
            'end': shift['end'],
            'duration': shift['duration'],
            'agents_a': int(agents_a),
            'agents_b': int(agents_b),
            'total': int(max_total),
            'intervals': len(shift_intervals)
        })

return pd.DataFrame(shift_results)
```

# ============= ANA FONKSÄ°YON =============

def calculate_all(df, interval_min=15):
â€œâ€â€
TÃ¼m hesaplama - Interval ve Vardiya

```
interval_min: 15 veya 30 (dakika)
"""

print("=" * 70)
print("KAPASÄ°TE PLANLAMA - 19 VARDÄ°YA")
print("=" * 70)

print(f"\nğŸ“‹ Ayarlar:")
print(f"   Ä°nterval: {interval_min} dakika")
print(f"   AHT: 180 saniye")
print(f"   Hedef ASA: 30 saniye")
print(f"   Shrinkage: %10")

# ADIM 1: Interval bazlÄ±
print("\nâš™ï¸ ADIM 1: Interval bazlÄ± hesaplama...")
interval_req = calculate_interval_requirements(df, interval_min=interval_min)

print(f"âœ… {len(interval_req)} interval hesaplandÄ±")
print(f"   Tarih sayÄ±sÄ±: {interval_req['date'].nunique()}")
print(f"   Peak: {interval_req['total_agents'].max()} agent")

# ADIM 2: Vardiya bazlÄ±
print("\nâš™ï¸ ADIM 2: Vardiya bazlÄ± hesaplama...")
shift_req = calculate_shift_requirements(interval_req, ALL_SHIFTS)

# SÄ±fÄ±r agentli vardiyalarÄ± filtrele
shift_req_active = shift_req[shift_req['total'] > 0]

print(f"âœ… {len(shift_req_active)} aktif vardiya-gÃ¼n kombinasyonu")
print(f"   (Toplam {len(shift_req)} olasÄ±lÄ±ktan)")

return interval_req, shift_req, shift_req_active
```

# ============= KENDÄ° VERÄ°NLE Ã‡ALIÅMA =============

def run_with_my_data(excel_path):
â€œâ€â€
Kendi Excel dosyanla Ã§alÄ±ÅŸtÄ±r

```
Excel formatÄ±:
- date: '2025-01-01' veya datetime
- time: '07:00' 
- queue_a: Ã§aÄŸrÄ± sayÄ±sÄ±
- queue_b: Ã§aÄŸrÄ± sayÄ±sÄ±
"""

print("ğŸ“‚ Excel dosyasÄ± okunuyor...")
df = pd.read_excel(excel_path)

# Kolon kontrolÃ¼
required_cols = ['date', 'time', 'queue_a', 'queue_b']
missing = [col for col in required_cols if col not in df.columns]

if missing:
    print(f"âŒ HATA: Eksik kolonlar: {missing}")
    return None

print(f"âœ… {len(df)} satÄ±r veri okundu")
print(f"   Tarih aralÄ±ÄŸÄ±: {df['date'].min()} - {df['date'].max()}")

# Hesapla (15 dakika interval)
interval_req, shift_req_all, shift_req_active = calculate_all(df, interval_min=15)

# Kaydet
print("\nğŸ’¾ SonuÃ§lar kaydediliyor...")
interval_req.to_excel('interval_sonuclari.xlsx', index=False)
shift_req_active.to_excel('vardiya_sonuclari.xlsx', index=False)

print("âœ… Kaydedildi:")
print("   - interval_sonuclari.xlsx")
print("   - vardiya_sonuclari.xlsx")

return interval_req, shift_req_all, shift_req_active
```

# ============= KULLANIM Ã–RNEÄÄ° =============

if **name** == â€˜**main**â€™:

```
print("\n" + "=" * 70)
print("KENDÄ° VERÄ°NLE Ã‡ALIÅTIRMA TALÄ°MATI")
print("=" * 70)
print("""
```

1. Excel dosyan ÅŸu kolonlara sahip olmalÄ±:
- date: â€˜2025-01-01â€™ formatÄ±nda
- time: â€˜07:00â€™, â€˜07:15â€™, â€˜07:30â€™ formatÄ±nda (15 dk interval)
- queue_a: A kuyruÄŸu Ã§aÄŸrÄ± sayÄ±sÄ±
- queue_b: B kuyruÄŸu Ã§aÄŸrÄ± sayÄ±sÄ±
1. Ã‡alÄ±ÅŸtÄ±rma:
   
   # YÃ¶ntem 1: Fonksiyon ile
   
   result = run_with_my_data(â€˜cagri_tahminleri.xlsxâ€™)
   
   # YÃ¶ntem 2: Manuel
   
   df = pd.read_excel(â€˜cagri_tahminleri.xlsxâ€™)
   interval_req, shift_req_all, shift_req_active = calculate_all(df, interval_min=15)
   shift_req_active.to_excel(â€˜sonuc.xlsxâ€™, index=False)
1. Ã‡Ä±ktÄ±:
- interval_sonuclari.xlsx: Her interval iÃ§in agent sayÄ±sÄ±
- vardiya_sonuclari.xlsx: Her gÃ¼n her vardiya iÃ§in agent sayÄ±sÄ±
  â€œâ€â€)
   
   print(â€\nâ€ + â€œ=â€ * 70)
   print(â€œTEST VERÄ°SÄ° Ä°LE Ã–RNEKâ€)
   print(â€=â€ * 70)
   
   # Test verisi (2 gÃ¼n, 15dk interval)
   
   times_15min = pd.date_range(â€˜00:00â€™, â€˜23:45â€™, freq=â€˜15minâ€™).strftime(â€™%H:%Mâ€™)
   
   test_data = pd.DataFrame({
   â€˜dateâ€™: [â€˜2025-01-15â€™] * len(times_15min) + [â€˜2025-01-16â€™] * len(times_15min),
   â€˜timeâ€™: list(times_15min) + list(times_15min),
   â€˜queue_aâ€™: [10, 12, 15, 18] * 24,  # Basit pattern
   â€˜queue_bâ€™: [5, 6, 8, 10] * 24
   })
   
   # Hesapla
   
   interval_req, shift_req_all, shift_req_active = calculate_all(test_data, interval_min=15)
   
   # SonuÃ§larÄ± gÃ¶ster
   
   print(â€\nğŸ“Š VARDÄ°YA SONUÃ‡LARI (Ä°lk 10 satÄ±r):â€)
   print(shift_req_active[[â€˜dateâ€™, â€˜shiftâ€™, â€˜startâ€™, â€˜endâ€™, â€˜agents_aâ€™, â€˜agents_bâ€™, â€˜totalâ€™]].head(10).to_string(index=False))
   
   print(â€\nâœ… Test tamamlandÄ±! Åimdi kendi verinle Ã§alÄ±ÅŸtÄ±rabilirsin.â€)
