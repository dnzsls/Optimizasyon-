â€œâ€â€
19 Vardiya ile Kapasite Planlama - Date kolonu eklendi
â€œâ€â€
import pandas as pd
import math

# ============= TEMEL FONKSÄ°YONLAR =============

def erlang_c(agents, traffic):
if agents <= traffic or agents == 0:
return 1.0
erlang_b = traffic / agents
for i in range(2, int(agents) + 1):
erlang_b = (traffic * erlang_b) / (i + traffic * erlang_b)
erlang_c_val = erlang_b / (1 - (traffic / agents) * (1 - erlang_b))
return min(erlang_c_val, 1.0)

def calculate_asa(agents, traffic, aht):
if agents <= traffic:
return 999
ec = erlang_c(agents, traffic)
asa = (ec * (aht / 60)) / (agents - traffic) * 60
return asa

def find_agents_for_target(calls, interval_min, aht, target_asa):
if calls == 0:
return 0
traffic = (calls * (aht / 60)) / interval_min
if traffic == 0:
return 0
min_agents = math.ceil(traffic)
max_agents = math.ceil(traffic * 2) + 5
for agents in range(min_agents, max_agents + 1):
asa = calculate_asa(agents, traffic, aht)
if asa <= target_asa:
return agents
return max_agents

def time_to_minutes(time_str):
â€œâ€â€â€˜07:30â€™ â†’ 450 dakikaâ€â€â€
h, m = map(int, time_str.split(â€™:â€™))
return h * 60 + m

def is_time_in_shift(time_str, shift_start, shift_end):
â€œâ€â€œBir zaman vardiya iÃ§inde mi kontrol et (gece vardiyasÄ± dahil)â€â€â€
time_min = time_to_minutes(time_str)
start_min = time_to_minutes(shift_start)
end_min = time_to_minutes(shift_end)

```
if end_min <= start_min:  # Gece vardiyasÄ±
    return time_min >= start_min or time_min < end_min
else:  # Normal vardiya
    return start_min <= time_min < end_min
```

# ============= 19 VARDÄ°YA TANIMI =============

SHIFTS_A21 = [
{â€˜nameâ€™: â€˜V1â€™, â€˜startâ€™: â€˜07:00â€™, â€˜endâ€™: â€˜16:00â€™, â€˜durationâ€™: 9.0},
{â€˜nameâ€™: â€˜V2â€™, â€˜startâ€™: â€˜08:00â€™, â€˜endâ€™: â€˜17:00â€™, â€˜durationâ€™: 9.0},
{â€˜nameâ€™: â€˜V3â€™, â€˜startâ€™: â€˜09:00â€™, â€˜endâ€™: â€˜18:00â€™, â€˜durationâ€™: 9.0},
{â€˜nameâ€™: â€˜V4â€™, â€˜startâ€™: â€˜10:00â€™, â€˜endâ€™: â€˜19:00â€™, â€˜durationâ€™: 9.0},
{â€˜nameâ€™: â€˜V5â€™, â€˜startâ€™: â€˜15:00â€™, â€˜endâ€™: â€˜24:00â€™, â€˜durationâ€™: 9.0},
{â€˜nameâ€™: â€˜V6â€™, â€˜startâ€™: â€˜17:00â€™, â€˜endâ€™: â€˜01:00â€™, â€˜durationâ€™: 8.0},
{â€˜nameâ€™: â€˜V7â€™, â€˜startâ€™: â€˜18:00â€™, â€˜endâ€™: â€˜02:00â€™, â€˜durationâ€™: 8.0},
{â€˜nameâ€™: â€˜V8â€™, â€˜startâ€™: â€˜19:00â€™, â€˜endâ€™: â€˜03:00â€™, â€˜durationâ€™: 8.0},
{â€˜nameâ€™: â€˜V9â€™, â€˜startâ€™: â€˜00:00â€™, â€˜endâ€™: â€˜08:00â€™, â€˜durationâ€™: 8.0},
]

SHIFTS_B21 = [
{â€˜nameâ€™: â€˜V10â€™, â€˜startâ€™: â€˜08:00â€™, â€˜endâ€™: â€˜17:30â€™, â€˜durationâ€™: 9.5},
{â€˜nameâ€™: â€˜V11â€™, â€˜startâ€™: â€˜09:00â€™, â€˜endâ€™: â€˜18:30â€™, â€˜durationâ€™: 9.5},
{â€˜nameâ€™: â€˜V12â€™, â€˜startâ€™: â€˜10:00â€™, â€˜endâ€™: â€˜19:30â€™, â€˜durationâ€™: 9.5},
{â€˜nameâ€™: â€˜V13â€™, â€˜startâ€™: â€˜11:00â€™, â€˜endâ€™: â€˜20:30â€™, â€˜durationâ€™: 9.5},
{â€˜nameâ€™: â€˜V14â€™, â€˜startâ€™: â€˜12:00â€™, â€˜endâ€™: â€˜21:30â€™, â€˜durationâ€™: 9.5},
{â€˜nameâ€™: â€˜V15â€™, â€˜startâ€™: â€˜13:00â€™, â€˜endâ€™: â€˜22:30â€™, â€˜durationâ€™: 9.5},
{â€˜nameâ€™: â€˜V16â€™, â€˜startâ€™: â€˜14:00â€™, â€˜endâ€™: â€˜23:30â€™, â€˜durationâ€™: 9.5},
{â€˜nameâ€™: â€˜V17â€™, â€˜startâ€™: â€˜15:00â€™, â€˜endâ€™: â€˜00:30â€™, â€˜durationâ€™: 9.5},
{â€˜nameâ€™: â€˜V18â€™, â€˜startâ€™: â€˜17:00â€™, â€˜endâ€™: â€˜01:30â€™, â€˜durationâ€™: 8.5},
{â€˜nameâ€™: â€˜V19â€™, â€˜startâ€™: â€˜18:00â€™, â€˜endâ€™: â€˜02:30â€™, â€˜durationâ€™: 8.5},
]

ALL_SHIFTS = SHIFTS_A21 + SHIFTS_B21

# ============= INTERVAL BAZLI Ä°HTÄ°YAÃ‡ =============

def calculate_interval_requirements(df, interval_min=30, aht=180,
target_asa=30, shrinkage=0.10):
â€œâ€â€
Her interval iÃ§in agent ihtiyacÄ± (BAÄIMSIZ)

```
DataFrame formatÄ±:
- date: '2025-01-01'
- time: '07:00'
- queue_a: Ã§aÄŸrÄ± sayÄ±sÄ±
- queue_b: Ã§aÄŸrÄ± sayÄ±sÄ±
"""
results = []

for idx, row in df.iterrows():
    date = row['date']
    time = row['time']
    calls_a = row['queue_a']
    calls_b = row['queue_b']
    
    # A iÃ§in
    agents_a_raw = find_agents_for_target(calls_a, interval_min, aht, target_asa)
    agents_a_final = math.ceil(agents_a_raw / (1 - shrinkage))
    
    # B iÃ§in
    agents_b_raw = find_agents_for_target(calls_b, interval_min, aht, target_asa)
    agents_b_final = math.ceil(agents_b_raw / (1 - shrinkage))
    
    results.append({
        'date': date,
        'time': time,
        'calls_a': calls_a,
        'calls_b': calls_b,
        'agents_a': agents_a_final,
        'agents_b': agents_b_final,
        'total_agents': agents_a_final + agents_b_final
    })

return pd.DataFrame(results)
```

# ============= VARDÄ°YA BAZLI Ä°HTÄ°YAÃ‡ =============

def calculate_shift_requirements(interval_df, shifts):
â€œâ€â€œVardiya bazlÄ± agent ihtiyacÄ±â€â€â€
shift_results = []

```
for shift in shifts:
    shift_intervals = interval_df[
        interval_df['time'].apply(
            lambda t: is_time_in_shift(t, shift['start'], shift['end'])
        )
    ]
    
    if len(shift_intervals) == 0:
        agents_a = 0
        agents_b = 0
        max_total = 0
    else:
        agents_a = shift_intervals['agents_a'].max()
        agents_b = shift_intervals['agents_b'].max()
        max_total = shift_intervals['total_agents'].max()
    
    shift_results.append({
        'shift': shift['name'],
        'start': shift['start'],
        'end': shift['end'],
        'duration': shift['duration'],
        'agents_a': int(agents_a),
        'agents_b': int(agents_b),
        'total': int(max_total),
        'intervals': len(shift_intervals)
    })

return pd.DataFrame(shift_results)
```

# ============= ANA FONKSÄ°YON =============

def calculate_all(df):
â€œâ€â€œTÃ¼m hesaplama - Interval ve Vardiyaâ€â€â€

```
print("=" * 70)
print("KAPASÄ°TE PLANLAMA - 19 VARDÄ°YA")
print("=" * 70)

# ADIM 1: Interval bazlÄ±
print("\nâš™ï¸ ADIM 1: Interval bazlÄ± hesaplama...")
interval_req = calculate_interval_requirements(df)

print(f"âœ… {len(interval_req)} interval hesaplandÄ±")
print(f"   Peak: {interval_req['total_agents'].max()} agent")
print(f"   Peak Saat: {interval_req.loc[interval_req['total_agents'].idxmax(), 'time']}")

# ADIM 2: Vardiya bazlÄ±
print("\nâš™ï¸ ADIM 2: Vardiya bazlÄ± hesaplama...")
shift_req = calculate_shift_requirements(interval_req, ALL_SHIFTS)

# SÄ±fÄ±r agentli vardiyalarÄ± filtrele
shift_req_active = shift_req[shift_req['total'] > 0]

print(f"âœ… {len(shift_req_active)} aktif vardiya bulundu")
print(f"   (Toplam 19 vardiyadan {len(shift_req) - len(shift_req_active)} boÅŸ)")

return interval_req, shift_req, shift_req_active
```

# ============= TEST =============

if **name** == â€˜**main**â€™:

```
# Ã–rnek veri (24 saat, 30dk interval = 48 satÄ±r)
times = pd.date_range('00:00', '23:30', freq='30min').strftime('%H:%M')

# Tek gÃ¼n Ã¶rnek
sample_data = pd.DataFrame({
    'date': '2025-01-15',  # â† DATE KOLONU EKLENDÄ°
    'time': times,
    'queue_a': [
        # 00:00-06:00 (Gece - az)
        5,5,5,5,5,5,8,8,10,10,12,12,
        # 06:00-12:00 (Sabah - artÄ±yor)
        20,25,30,40,50,55,60,60,58,56,54,52,
        # 12:00-18:00 (Ã–ÄŸle-AkÅŸam - yÃ¼ksek)
        50,48,46,44,50,55,60,58,56,54,52,50,
        # 18:00-24:00 (Gece - azalÄ±yor)
        45,40,35,30,25,20,15,12,10,8,6,5
    ],
    'queue_b': [
        # 00:00-06:00
        3,3,3,3,3,3,5,5,6,6,8,8,
        # 06:00-12:00
        10,12,15,20,25,28,30,30,29,28,27,26,
        # 12:00-18:00
        25,24,23,22,25,28,30,29,28,27,26,25,
        # 18:00-24:00
        22,20,18,15,12,10,8,6,5,4,3,3
    ]
})

# Hesapla
interval_req, shift_req_all, shift_req_active = calculate_all(sample_data)

# SonuÃ§larÄ± gÃ¶ster
print("\n" + "=" * 70)
print("ğŸ“Š VARDÄ°YA SONUÃ‡LARI (Aktif Vardiyalar)")
print("=" * 70)
print(shift_req_active.to_string(index=False))

# Interval sonuÃ§larÄ± (ilk 10)
print("\n" + "=" * 70)
print("ğŸ“Š INTERVAL SONUÃ‡LARI (Ä°lk 10 satÄ±r)")
print("=" * 70)
print(interval_req[['date', 'time', 'calls_a', 'calls_b', 'agents_a', 'agents_b', 'total_agents']].head(10).to_string(index=False))

print("\n" + "=" * 70)
print("âœ… HESAPLAMA TAMAMLANDI")
print("=" * 70)
```
